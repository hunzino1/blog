---
layout:     post
title:      计算机网络(1) - 网络分层、TCP、IP、Http、Socket总结
category: interview
tags: [interview]
excerpt: 每天一句话，成天逼逼啥
---

网络分层、TCP、IP、Http、Socket总结
=====================================

本文是对TCP、IP、Http、Socket等基础知识做一总结，读完本篇博文，您将了解到：

* 网络分层
* tcp/IP
* http
* socket

有误之处还请指正。

--------------------------------------------------------

面试总结
=========

UDP
------------------

UDP和TCP一样，都是传输层上的一个协议，不过UDP是面向非连接的协议。

```html
TCP（Transmission Control Protocol，传输控制协议）是基于连接的协议，也就是说，在正式收发数据前，必须和对方建立可靠的连接。一个TCP连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，我们这里只做简单、形象的介绍，你只要做到能够理解这个过程即可。我们来看看这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接和要求同步（同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。

(ping-pang原理)
UDP（User Data Protocol，用户数据报协议）是与TCP相对应的协议。它是面向非连接的协议，它不与对方建立连接，而是直接就把数据包发送过去！
  UDP适用于一次只传送少量数据、对可靠性要求不高的应用环境。比如，我们经常使用“ping”命令来测试两台主机之间TCP/IP通信是否正常，其实“ping”命令的原理就是向对方主机发送UDP数据包，然后对方主机确认收到数据包，如果数据包是否到达的消息及时反馈回来，那么网络就是通的。例如，在默认状态下，一次“ping”操作发送4个数据包（如图2所示）。大家可以看到，发送的数据包数量是4包，收到的也是4包（因为对方主机收到后会发回一个确认收到的数据包）。这充分说明了UDP协议是面向非连接的协议，没有建立连接的过程。正因为UDP协议没有连接的过程，所以它的通信效果高；但也正因为如此，它的可靠性不如TCP协议高。QQ就使用UDP发消息，因此有时会出现收不到消息的情况。

tcp协议和udp协议的差别
             TCP       UDP
是否连接     面向连接   面向非连接
传输可靠性     可靠      不可靠
应用场合    传输大量数据  少量数据
速度          慢          快
```

TCP和UDP的区别
----------------

1. TCP是面向链接的，虽然说网络的不安全不稳定特性决定了多少次握手都不能保证连接的可靠性，但TCP的三次握手在最低限度上(实际上也很大程度上保证了)保证了连接的可靠性;
而UDP不是面向连接的，UDP传送数据前并不与对方建立连接，对接收到的数据也不发送确认信号，发送端不知道数据是否会正确接收，当然也不用重发，所以说UDP是无连接的、不可靠的一种数据传输协议。
2. 也正由于1所说的特点，使得UDP的开销更小数据传输速率更高，因为不必进行收发数据的确认，所以UDP的实时性更好。

知道了TCP和UDP的区别，就不难理解为何采用TCP传输协议的MSN比采用UDP的QQ传输文件慢了，但并不能说QQ的通信是不安全的，

因为程序员可以手动对UDP的数据收发进行验证，比如发送方对每个数据包进行编号然后由接收方进行验证啊什么的，

即使是这样，UDP因为在底层协议的封装上没有采用类似TCP的“三次握手”而实现了TCP所无法达到的传输效率。

常用的协议位于那一层
--------------------

- IP协议对应于网络层
- TCP协议对应于传输
- HTTP协议对应于应用层
- wifi是基于数据链路层和物理层的。

TCP/IP和HTTP的关系
--------------------

关于TCP/IP和HTTP协议的关系，网络有一段比较容易理解的介绍：

> “我们在传输数据时，可以只使用(传输层)TCP/IP协议，但是那样的话，如果没有应用层，便无法识别数据内容。

如果想要使传输的数据有意义，则必须使用到应用层协议。应用层协议有很多，比如HTTP、FTP、TELNET等，也可以自己定义应用层协议。WEB使用HTTP协议作应用层协议，以封装HTTP文本信息，然后使用TCP/IP做传输层协议将它发到网络上。

Socket
--------

注意：

Socket本身并不是协议，而是一个调用接口(API)，它只是提供了一个针对TCP或者UDP编程的接口。

socket是对TCP/IP协议的封装和应用,TPC/IP协议是传输层协议，主要解决数据如何在网络中传输

通过Socket，我们才能使用TCP/IP协议。实际上，Socket跟TCP/IP协议没有必然的联系。Socket编程接口在设计的时候，就希望也能适应其他的网络协议。所以说，Socket的出现只是使得程序员更方便地使用TCP/IP协议栈而已，是对TCP/IP协议的抽象，从而形成了我们知道的一些最基本的函数接口，比如create、listen、connect、accept、send、read和write等等。

Socket和TCP/IP协议的关系
----------------------------

网络有一段关于socket和TCP/IP协议关系的说法比较容易理解：

> “TCP/IP只是一个协议栈，就像操作系统的运行机制一样，必须要具体实现，同时还要提供对外的操作接。
> 这个就像操作系统会提供标准的编程接口，比如win32编程接口一样，
> TCP/IP也要提供可供程序员做网络开发所用的接口，这就是Socket编程接口。”

HTTP和Socket的关系
-----------------------

CSDN上有个比较形象的描述：

> HTTP是轿车，提供了封装或者显示数据的具体形式;Socket是发动机，提供了网络通信的能力。

利用Socket建立网络连接的步骤
--------------------------------

建立Socket连接至少需要一对套接字，其中一个运行于客户端，称为ClientSocket ，另一个运行于服务器端，称为ServerSocket 。

套接字之间的连接过程分为三个步骤：服务器监听，客户端请求，连接确认。

1. 服务器监听：服务器端套接字并不定位具体的客户端套接字，而是处于等待连接的状态，实时监控网络状态，等待客户端的连接请求。
2. 客户端请求：指客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。
为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。
3. 连接确认：当服务器端套接字监听到或者说接收到客户端套接字的连接请求时，就响应客户端套接字的请求，建立一个新的线程，把服务器端套接字的描述发给客户端，一旦客户端确认了此描述，双方就正式建立连接。

而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。

HTTP链接的特点
---------------

HTTP协议即超文本传送协议(Hypertext Transfer Protocol )，是Web联网的基础，也是手机联网常用的协议之一，HTTP协议是建立在TCP协议之上的一种应用。

HTTP连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为“一次连接”。


网络分层
-----------

网络分层就是将网络节点所要完成的数据的发送或转发、打包或拆包，控制信息的加载或拆出等工作，分别由不同的硬件和软件模块去完成。这样可以将往来通信和网络互连这一复杂的问题变得较为简单。

五层因特网协议栈（从上到下）
---------------------------

- 应用层
- 传输层
- 网络层
- 链路层
- 物理层

五层因特网协议栈介绍
--------------------

- 应用层

用于支持支持网络应用，运行在不同主机上的进程则使用应用层协议进行通信。主要的协议有：http、ftp、telnet、smtp、pop3等。

- 传输层

负责为信源和信宿提供应用程序进程间的数据传输服务，这一层上主要定义了两个传输协议，传输控制协议即TCP和用户数据报协议UDP。

- 网络层

负责将数据报独立地从信源发送到信宿，主要解决路由选择、拥塞控制和网络互联等问题。

- 数据链路层

负责将IP数据报封装成合适在物理网络上传输的帧格式并传输，或将从物理网络接收到的帧解封，取出IP数据报交给网络层。

- 物理层

负责将比特流在结点间传输，即负责物理传输。该层的协议既与链路有关也与传输介质有关

七层因特网协议栈（从上到下）
----------------------------

- 应用层(Application)
- 表示层(Presentation)
- 会话层(Session)
- 传输层(Transport)
- 网络层(Network)
- 数据链路层(Data Link)
- 物理层(Physical)

和五层结构有什么区别

> 个人理解五层结构就是把7层结构的 应用层/表示层/会话层 合为一个应用层

7层因特网协议栈介绍
-------------------

#### 一句话概述

> 应用层 指网络操作系统和具体的应用程序，对应WWW服务器、FTP服务器等应用软件　
>
> 表示层 数据语法的转换、数据的传送等　
>
> 会话层 建立起两端之间的会话关系，并负责数据的传送　
>
> 传输层 负责错误的检查与修复，以确保传送的质量，是TCP协议工作的地方。（报文）
>
> 网络层 提供了编址方案,IP协议工作的地方(数据包）　
>
> 数据链路层 将由物理层传来的未经处理的位数据包装成数据帧　
>
> 物理层 对应网线、网卡、接口等物理设备(位)。

- 物理层

物理层(Physical layer)是参考模型的最低层。该层是网络通信的数据传输介质，由连接不同结点的电缆与设备共同构成。主要功能是：利用传输介质为数据链路层提供物理连接，负责处理数据传输并监控数据出错率，以便数据流的透明传输。

- 数据链路层

数据链路层(Data link layer)是参考模型的第2层。 主要功能是：在物理层提供的服务基础上，在通信的实体间建立数据链路连接，传输以“帧”为单位的数据包，并采用差错控制与流量控制方法，使有差错的物理线路变成无差错的数据链路。

- 网络层

网络层(Network layer)是参考模型的第3层。主要功能是：为数据在结点之间传输创建逻辑链路，通过路由选择算法为分组通过通信子网选择最适当的路径，以及实现拥塞控制、网络互联等功能。

- 传输层

传输层(Transport layer)是参考模型的第4层。主要功能是向用户提供可靠的端到端(End-to-End)服务，处理数据包错误、数据包次序，以及其他一些关键传输问题。传输层向高层屏蔽了下层数据通信的细节，因此，它是计算机通信体系结构中关键的一层。

- 会话层

会话层(Session layer)是参考模型的第5层。主要功能是：负责维护两个结点之间的传输链接，以便确保点到点传输不中断，以及管理数据交换等功能。

- 表示层

表示层(Presentation layer)是参考模型的第6层。主要功能是：用于处理在两个通信系统中交换信息的表示方式，主要包括数据格式变换、数据加密与解密、数据压缩与恢复等功能。

- 应用层

应用层(Application layer)是参考模型的最高层。主要功能是：为应用软件提供了很多服务，例如文件服务器、数据库服务、电子邮件与其他网络软件服务。

总结图
-------

![](https://hunzino1.github.io/assets/images/2019/interview/internet1.png)

**这张图是重点，记录每层对应的协议是什么**
![](https://hunzino1.github.io/assets/images/2019/interview/internet2.png)

我的记忆总结
------------

参考模型理解记忆： 7层模型可以在5层模型的基础上记忆,而且实际应用只有五层。

自上而下：

- 应用层： 即应用，常用的网址协议http， 其他还有ftp、dns等，也就是我们直接访问的。 
- 传输层： TCP协议，理解TCP就知道这是啥意思了，上一步发出请求，这一步就是客户端和服务器去连接了，三次握手。 那这时候只是连上了，还没交换数据。报文
- 网络层： 应该跟传输层一起的， TCP/IP, 这一层是IP协议，就是找服务器主机呢。  图中说为数据包提供路由，路由可不就是服务器地址吗。 这不就是平时所说的网不好吗，ip连不上。
- 数据链路层： 这一步就是连接上了该传输数据了， 按帧传输。   这个时候应该只是将数据预处理一下。
- 物理层： 就是网线、光缆连接，真正转换成了二进制的形式，计算机识别了。

以上五层参考实际意义和已知的TCP、IP、http知识，很容易理解。

那么在此基础上加上两层，并且没有协议的，这两层花精力记一下即可,不用理解。

- 表示层：  数据格式处理
- 会话层：  建立节点联系。

