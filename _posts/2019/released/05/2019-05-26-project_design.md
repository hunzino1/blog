---
layout:     post
title:      设计一个电商平台积分兑换系统
category: stack
tags: [stack]
excerpt: 一个人有多努力，就会有多幸运。
---

[设计一个电商平台积分兑换系统](https://maimai.cn/article/detail?fid=1252495809&efid=0fjwMCDG17Y5XvRkRRwE4g)
=======================================

类似的这类系统设计题目很多，比如：

请你设计一个秒杀系统

请你设计一个支撑百万用户的IM消息系统

请你设计一个微信红包系统

请你设计一个电商平台积分兑换系统

这些题目本身都是开放式命题，没有固定答案。遇到这种问题，一定不要慌，关键是在现场要思路清楚，有理有据，慢慢分析。

-------------------------------------

1 设计思路
------------------------------------

对这类开放式面试题的一个回答思路，首先得从业务上来考虑这个系统应该有哪些业务组成部分，如何实现业务流程？

其次就是你得考虑面临对应的业务场景的时候，这个系统会有哪些技术挑战，各个环节可能会有哪些技术问题？

然后应该针对这些技术挑战和技术问题，现场给出一些你的思路。只要给出大致的思路就可以，比如应该往哪个方向去解决，应该引入哪些机制。

```html
说实话，大部分人是没实际做过这类系统的。比如让你设计一个秒杀系统，如何设计？

试问，国内有多少人真的做过秒杀系统？其实面试官只不过是通过这个问题考察你的技术面、技术功底，
对各种常规技术方案的积累，以及现场分析业务，分析技术问题，进而基于你过去的技术积累，给出合理解决方案的一个能力。
```

总结起来就是：

1. 业务逻辑设计 --    表结构设计
2. 业务场景     --    事务等
3. 技术挑战     --    中间件，重试机制，幂等算法等

下面是各个面试案例的具体思路：

2 设计一个电商平台积分兑换系统
-------------------------------------

[传送门](https://maimai.cn/article/detail?fid=1252495809&efid=0fjwMCDG17Y5XvRkRRwE4g)

### 2.1 业务逻辑设计(表结构设计)

如下，业务逻辑设计和表结构分析并不是太难的事，这一步的难点是逻辑思维是否缜密，

> 比如是否考虑到查看物流信息等；

| 表名      |表结构|
| ----      | --   |
| 积分表    | 略     |
| 积分兑换表|  略    |
| 发货申请表|  略    |

![pro_design_data](https://hunzino1.github.io/assets/images/2019/interview/pro_design_data.png)

### 2.2 业务场景设计（事务）

第一步只是给出了基本的数据库表定义；

而具体的业务逻辑实现需要考虑到数据增删改查问题了；

所以要考虑是否需要用到事务？

> 扣减积分、新增积分兑换记录、新增发货申请单，这三个步骤必须是要么一起完成，要么一起失败的。
> 
> 也就是说，这三个步骤必须是在一个事务里的。

而如上图，积分和物流是两个服务，相互独立，怎么能保证事务？

其中不太好的一个思路是分布式事务。

但是其实有根间的方案：

> 在事务的最后一步调用仓储服务的接口，如果接口调用成功就提交事务；调用失败则抛异常让事务回滚即可。

![pro_design_transaction](https://hunzino1.github.io/assets/images/2019/interview/pro_design_transaction.png)

### 2.3 技术挑战

问题： 其实用户操作积分兑换后，其实不必关心仓储服务是否成功，即不必一直等待服务的响应。

解决方案： 增加中间件，给仓储服务发一条增加发货申请表记录的消息即可；

添加成功后仓储服务会发一条回执；

那么，万一接受失败了呢？

解决方案：重试机制保证可靠性，如果在时间阈内没有收到反馈，重发；

那么，万一重复消费了呢？

解决方案： 幂等性机制，将积分兑换表记录的id传给储服务，已存在的记录直接返回(唯一性索引)；

![pro_design_score](https://hunzino1.github.io/assets/images/2019/interview/pro_design_score.png)

### 2.4 总结

以上就是一个简单的设计思路，这里只针对面试，并不是真正的实现一个可执行系统，只是一个思路的提供；

下面再总结几个常见的系统设计问题，并不会想上述这般详细了，领会思路即可；
